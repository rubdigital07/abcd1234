<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,user-scalable=no" />
  <title>Thiá»‡p 20/10 â€“ HÃ nh TrÃ¬nh Ná»Ÿ Hoa ğŸŒ¸</title>
  <link href="https://fonts.googleapis.com/css2?family=Mali:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{--rose:#d81b60;--rose-2:#f06292;--bg1:#fff0f5;--bg2:#ffeaf0}
    body{font-family:"Mali",cursive;background:linear-gradient(135deg,var(--bg1),var(--bg2));height:100vh;overflow:hidden;color:var(--rose)}
    button{cursor:pointer;border:none;outline:none}
    .hidden{display:none !important}
    .center{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(255,255,255,.86);border-radius:28px;padding:28px 32px;text-align:center;box-shadow:0 20px 60px rgba(216,27,96,.28);backdrop-filter:saturate(1.1) blur(6px);width:min(92vw,720px)}
    .title{font-weight:700;font-size:2rem;background:linear-gradient(45deg,var(--rose),var(--rose-2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:8px}
    .desc{font-size:1.1rem;line-height:1.65}
    .btn{margin-top:18px;padding:12px 22px;border-radius:28px;color:#fff;background:linear-gradient(135deg,var(--rose),var(--rose-2));font-weight:700;box-shadow:0 8px 24px rgba(216,27,96,.32);transition:.25s transform;display:inline-flex;align-items:center;gap:.5rem}
    .btn:hover{transform:translateY(-1px) scale(1.02)}
    .btn-outline{background:#fff;color:var(--rose);border:2px solid var(--rose-2)}
    .fade-in{animation:fadeIn .6s ease forwards}
    @keyframes fadeIn{from{opacity:0;transform:translate(-50%,-48%)}to{opacity:1;transform:translate(-50%,-50%)}}

    /* QuÃ  rÆ¡i */
    .falling{position:absolute;top:-80px;width:54px;user-select:none;animation:fall 9s linear forwards;filter:drop-shadow(0 6px 10px rgba(0,0,0,.18))}
    @keyframes fall{0%{transform:translateY(-10vh) rotate(0deg);opacity:1}100%{transform:translateY(110vh) rotate(360deg);opacity:.15}}

    /* Tim ná»• */
    .heart{position:absolute;pointer-events:none;animation:burst 1.5s ease-out forwards;font-size:20px}
    @keyframes burst{0%{transform:translate(-50%,-50%) scale(.55);opacity:1}100%{transform:translate(var(--dx),var(--dy)) scale(1.9);opacity:0}}

    /* Há»™p quÃ  */
    .gift-wrap{display:flex;align-items:center;justify-content:center;gap:14px;margin-top:14px}
    .gift{width:120px;height:120px;border-radius:16px;background:#ffe2ec;display:flex;align-items:center;justify-content:center;box-shadow:0 16px 40px rgba(216,27,96,.25);position:relative;overflow:hidden}
    .ribbon{position:absolute;width:20px;height:100%;background:var(--rose);left:calc(50% - 10px)}
    .ribbon:before{content:"";position:absolute;top:calc(50% - 10px);left:-50px;right:-50px;height:20px;background:var(--rose)}
    .box-lid{position:absolute;top:-4px;left:8px;right:8px;height:22px;border-radius:12px;background:linear-gradient(45deg,#ffc2d6,#ffa3c5)}
    .flower-rise {position: fixed;left: 50%;bottom: 40%;transform: translateX(-50%) scale(0.8);width: 180px;opacity: 0;animation: flowerRise 2.4s ease-out forwards;z-index: 15;}
    @keyframes flowerRise {0% {opacity: 0;transform: translate(-50%, 40%) scale(0.8);}50% {opacity: 1;transform: translate(-50%, -10%) scale(1);}100% {opacity: 0;transform: translate(-50%, -50%) scale(1.2);}}

    /* Thiá»‡p yÃªu thÆ°Æ¡ng */
    .envelope {position: relative;width: 240px;height: 180px;margin: 0 auto 20px;perspective: 1000px;}
    .envelope-top {position: absolute;width: 100%;height: 100%;background: #ffc2d6;border-radius: 8px;transform-origin: top;transition: transform 0.8s ease;}
    .envelope.open .envelope-top {transform: rotateX(150deg);}
    .envelope-letter {position: absolute;inset: 0;background: #fff;border-radius: 8px;padding: 20px;box-shadow: 0 6px 20px rgba(0,0,0,0.2);transform: translateY(100%);opacity: 0;transition: all 0.8s ease 0.4s;}
    .envelope.open .envelope-letter {transform: translateY(0);opacity: 1;}
    .letter-text {font-size: 1.05rem;color: var(--rose);}
    .letter-deco {margin-top: 12px;font-size: 1.3rem;}
  </style>
</head>
<body>
  <!-- Stage 1 -->
  <section id="stage1" class="center fade-in">
    <div class="title">ChÃºc má»«ng 20/10</div>
    <p class="desc">Má»™t ngÃ y má»›i báº¯t Ä‘áº§u â€“ ngÃ y dÃ nh riÃªng cho báº¡n. CÃ¹ng bÆ°á»›c vÃ o hÃ nh trÃ¬nh ná»Ÿ hoa nhÃ©! ğŸ’Œ</p>
    <button id="btnStart" class="btn">Báº¯t Ä‘áº§u hÃ nh trÃ¬nh</button>
  </section>

  <!-- Stage 2 -->
  <section id="stage2" class="center hidden">
    <div class="title">CÆ¡n mÆ°a yÃªu thÆ°Æ¡ng ğŸŒ¸</div>
    <p class="desc">Cháº¡m vÃ o nhá»¯ng mÃ³n quÃ  rÆ¡i xuá»‘ng Ä‘á»ƒ nháº­n lá»i chÃºc Ä‘áº§u tiÃªn (báº¯t 3 mÃ³n)!</p>
  </section>

  <!-- Popup -->
  <div id="popup" class="center hidden">
    <div class="title">Lá»i chÃºc gá»­i Ä‘áº¿n báº¡n ğŸ’–</div>
    <img id="popupImg" src="" style="width:100%;border-radius:16px;margin:12px 0;">
    <p id="popupText" class="desc"></p>
    <button id="btnPopupNext" class="btn">Tiáº¿p tá»¥c ğŸŒº</button>
  </div>

  <!-- Stage 4 -->
  <section id="stage4" class="center hidden">
    <div class="title">ğŸŒº Cáº£m Æ¡n báº¡n ğŸŒº</div>
    <p class="desc">VÃ¬ báº¡n Ä‘Ã£ mang Ä‘áº¿n tháº¿ giá»›i nÃ y sá»± dá»‹u dÃ ng, máº¡nh máº½ vÃ  yÃªu thÆ°Æ¡ng. HÃ£y Ä‘Ã³n nháº­n Ä‘iá»u xinh xáº¯n tiáº¿p theo!</p>
    <button id="btnToBox" class="btn">Má»Ÿ há»™p quÃ  bÃ­ máº­t ğŸ</button>
  </section>

  <!-- Stage 6 â€“ Há»™p quÃ  -->
  <section id="stage6" class="center hidden">
    <div class="title">Há»™p quÃ  bÃ­ máº­t ğŸ</div>
    <p class="desc">Cháº¡m má»Ÿ má»™t trong ba há»™p quÃ . BÃªn trong lÃ  bÃ³ hoa dÃ nh cho báº¡n!</p>
    <div id="giftWrap" class="gift-wrap">
      <div class="gift" data-i="0"><div class="box-lid"></div><div class="ribbon"></div></div>
      <div class="gift" data-i="1"><div class="box-lid"></div><div class="ribbon"></div></div>
      <div class="gift" data-i="2"><div class="box-lid"></div><div class="ribbon"></div></div>
    </div>
    <button id="btnToLetter" class="btn hidden">Má»Ÿ thiá»‡p yÃªu thÆ°Æ¡ng ğŸ’Œ</button>
  </section>

  <!-- Stage 7 â€“ Thiá»‡p yÃªu thÆ°Æ¡ng -->
  <section id="stage7" class="center hidden">
    <div class="title">ğŸ’Œ Má»Ÿ thiá»‡p yÃªu thÆ°Æ¡ng</div>
    <div class="envelope" id="envelope">
      <div class="envelope-top"></div>
      <div class="envelope-letter">
        <p class="letter-text">ChÃºc báº¡n luÃ´n xinh Ä‘áº¹p, háº¡nh phÃºc vÃ  Ä‘Æ°á»£c yÃªu thÆ°Æ¡ng trá»n váº¹n má»—i ngÃ y ğŸŒ·</p>
        <div class="letter-deco">ğŸ’–ğŸŒ¸ğŸ’–</div>
      </div>
    </div>
    <button id="btnToEnd" class="btn btn-outline">Káº¿t thÃºc hÃ nh trÃ¬nh ğŸŒ·</button>
  </section>

  <!-- Stage 8 -->
  <section id="stage8" class="center hidden">
    <div class="title">ğŸ’ ChÃºc má»«ng 20/10 ğŸ’</div>
    <p class="desc">Má»—i bÃ´ng hoa Ä‘á»u Ä‘áº¹p theo cÃ¡ch riÃªng. VÃ  báº¡n cÅ©ng tháº¿. HÃ£y lan tá»a yÃªu thÆ°Æ¡ng nhÃ©!</p>
    <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:10px">
      <button id="btnShare" class="btn">ğŸ“¤ Chia sáº» thiá»‡p</button>
      <button id="btnReplay" class="btn btn-outline">ğŸ” ChÆ¡i láº¡i hÃ nh trÃ¬nh</button>
    </div>
  </section>

  <audio id="bgm" src="./assets/a.mp3" preload="auto"></audio>

  <script>
    const gifts = ["./assets/a1.jpg","./assets/a2.jpg","./assets/a3.jpg","./assets/a4.jpg"];
    const messages = [
      "ChÃºc báº¡n luÃ´n xinh Ä‘áº¹p vÃ  ngáº­p trÃ n yÃªu thÆ°Æ¡ng ğŸ’",
      "HÃ´m nay, má»i Ã¡nh sÃ¡ng Ä‘á»u thuá»™c vá» báº¡n âœ¨",
      "Cáº£m Æ¡n báº¡n vÃ¬ Ä‘Ã£ mang Ä‘iá»u tá»‘t Ä‘áº¹p Ä‘áº¿n tháº¿ giá»›i nÃ y ğŸ’–",
      "Báº¡n chÃ­nh lÃ  Ä‘oÃ¡ hoa Ä‘áº¹p nháº¥t cá»§a ngÃ y hÃ´m nay ğŸŒ¸"
    ];

    const E = {
      bgm: document.getElementById("bgm"),
      stage1: document.getElementById("stage1"),
      stage2: document.getElementById("stage2"),
      popup: document.getElementById("popup"),
      popupImg: document.getElementById("popupImg"),
      popupText: document.getElementById("popupText"),
      stage4: document.getElementById("stage4"),
      stage6: document.getElementById("stage6"),
      stage7: document.getElementById("stage7"),
      stage8: document.getElementById("stage8"),
      btnStart: document.getElementById("btnStart"),
      btnPopupNext: document.getElementById("btnPopupNext"),
      btnToBox: document.getElementById("btnToBox"),
      btnToLetter: document.getElementById("btnToLetter"),
      btnToEnd: document.getElementById("btnToEnd"),
      btnShare: document.getElementById("btnShare"),
      btnReplay: document.getElementById("btnReplay"),
      giftWrap: document.getElementById("giftWrap"),
      envelope: document.getElementById("envelope")
    };

    let catched = 0, msgIndex = 0, dropTimer = null;

    function showStage(n) {
      ["stage1","stage2","popup","stage4","stage6","stage7","stage8"]
      .forEach(id => E[id].classList.add("hidden"));
      E["stage"+n].classList.remove("hidden");
    }

    function heartBurst(x,y,count=10){
      for(let i=0;i<count;i++){
        const h=document.createElement("div");
        h.textContent="ğŸ’–";
        h.className="heart";
        const a=Math.random()*Math.PI*2,d=60+Math.random()*80;
        h.style.left=x+"px";h.style.top=y+"px";
        h.style.setProperty("--dx",Math.cos(a)*d+"px");
        h.style.setProperty("--dy",Math.sin(a)*d+"px");
        document.body.appendChild(h);
        setTimeout(()=>h.remove(),1500);
      }
    }

    function spawnFalling(){
      const img=document.createElement("img");
      img.src=gifts[Math.floor(Math.random()*gifts.length)];
      img.className="falling";
      img.style.left=Math.random()*(window.innerWidth-70)+"px";
      img.onclick=e=>{
        img.remove();
        catched++;
        heartBurst(e.clientX,e.clientY,10);
        showPopup();
      };
      document.body.appendChild(img);
      setTimeout(()=>img.remove(),9000);
    }

    function startRain(){
      catched=0;
      dropTimer=setInterval(spawnFalling,1200);
    }
    function stopRain(){clearInterval(dropTimer);dropTimer=null;}

    function showPopup(){
      E.stage2.classList.add("hidden");
      E.popup.classList.remove("hidden");
      E.popupImg.src=gifts[msgIndex%gifts.length];
      E.popupText.textContent=messages[msgIndex%messages.length];
      msgIndex++;
    }

    E.btnStart.onclick=()=>{
      E.bgm.play();
      showStage(2);
      startRain();
    };

    E.btnPopupNext.onclick=()=>{
      E.popup.classList.add("hidden");
      if(catched>=3){
        stopRain();
        showStage(4);
      } else E.stage2.classList.remove("hidden");
    };

    E.btnToBox.onclick=()=>showStage(6);

    // Há»™p quÃ  má»Ÿ ra bÃ³ hoa
    E.giftWrap.onclick=(e)=>{
      const box=e.target.closest(".gift");
      if(!box)return;
      const lid=box.querySelector(".box-lid");
      if(lid){lid.style.transition="transform .4s ease";lid.style.transform="translateY(-60px) rotate(-8deg)";}
      const flower=document.createElement("img");
      flower.src="./assets/bouquet.png";
      flower.className="flower-rise";
      document.body.appendChild(flower);
      const r=box.getBoundingClientRect();
      heartBurst(r.left+r.width/2,r.top+r.height/2,16);
      setTimeout(()=>flower.remove(),3000);
      setTimeout(()=>E.btnToLetter.classList.remove("hidden"),1000);
    };

    E.btnToLetter.onclick=()=>showStage(7);

    E.envelope.onclick=()=>E.envelope.classList.toggle("open");

    E.btnToEnd.onclick=()=>showStage(8);

    E.btnShare.onclick=async()=>{
      const url=window.location.href;
      const text="ğŸ’Œ Thiá»‡p 20/10 cá»±c xinh mÃ¬nh vá»«a nháº­n, cÃ¹ng khÃ¡m phÃ¡ nhÃ©!";
      if(navigator.share){await navigator.share({title:"Thiá»‡p 20/10",text,url});}
      else{await navigator.clipboard.writeText(url);alert("ÄÃ£ sao chÃ©p liÃªn káº¿t chia sáº»!");}
    };

    E.btnReplay.onclick=()=>{msgIndex=0;catched=0;showStage(1);};
    document.body.addEventListener("click",()=>{if(E.bgm.paused)E.bgm.play();},{once:true});
  </script>
</body>
</html>
